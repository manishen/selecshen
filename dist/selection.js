var Selection=function(e){var t="selection",n=".ma.selection",a=e.fn[t],i=(new RegExp("38|40|27"),{HIDE:"hide"+n,HIDDEN:"hidden"+n,SHOW:"show"+n,SHOWN:"shown"+n,CHANGE:"changed"+n,CLICK:"click"+n,CLICK_ITEM:"click.ma.selection.item",CLICK_BTN_CLEAN:"click.ma.selection.btn.clean",CLICK_RESET:"click.ma.selection.btn.reset",CLICK_DATA_API:"click.ma.selection.data-api",KEYDOWN_DATA_API:"keydown.ma.selection.data-api",KEYUP_DATA_API:"keyup.ma.selection.data-api"}),s={DISABLED:"disabled",SHOW:"show",CHECKED:"checked",HIDE:"hide",MIN:"min",MAX:"max"},r={CAPTION:".selection-caption",DATA_TOGGLE:'[data-toggle="selection"]',CLEAN_BUTTON:".selection-btn.clean",DROPDOWN:".selection-dropdown",INPUT:".selection-input",INPUT_MIN:".selection-input.min",INPUT_MAX:".selection-input.max",LIST:".selection-list",ITEM:".selection-item",HIDDEN_ITEMS:".selection-item.hide",VISIBLE_ITEMS:".selection-item:not(.hide)",CHECKED_ITEMS:".selection-item.checked",ACCEPT_BUTTON:".selection-action.accept",RESET_BUTTON:".selection-action.reset",NEW_BUTTON:".selection-action.new",HIDDEN_VALUES:"input:hidden.value"},l=function(){function t(e,n){this._element=e,this._config=this._getConfig(n),this._parent=t._getParentFromElement(e),this._dropdown=this._getDropdownElement(),this._list=this._getListElement(),this._minItem=null,this._maxItem=null,this._memory={min:"",max:"",selectedItems:[]},this._addEventListeners(),this._setLabel(),this._toggleCleanButton(),this._element.setAttribute("tabindex","0")}return t.prototype.toggle=function(){if(!this._element.disabled&&!e(this._element).hasClass(s.DISABLED)){var n=t._getParentFromElement(this._element),a=this._dropdown.hasClass(s.SHOW);if(t._clearLists(),this._toggleCleanButton(),a)return void this._refreshValueInputs();var l={relatedTarget:this._element},o=e.Event(i.SHOW,l);if(e(n).trigger(o),!o.isDefaultPrevented()){var h=this._element;this._element.focus(),h.setAttribute("aria-expanded","true"),e(this._dropdown).toggleClass(s.SHOW),e(n).toggleClass(s.SHOW).trigger(e.Event(i.SHOWN,l)),this._config.type&&"range"===this._config.type&&e(this._list).addClass(s.MIN).removeClass(s.MAX);var _=e(this._parent).find(r.INPUT);_.length&&_[0].focus(),this._saveMemory()}}},t.prototype.toggleItem=function(t){if(void 0!==this._config.type)switch(this._config.type){case"single":this._unchekedItems(),e(t).toggleClass(s.CHECKED),this.toggle();break;case"multiple":0===e.makeArray(e(this._list).find(r.CHECKED_ITEMS+"[data-similar="+t.getAttribute("data-similar")+"]")).length&&this._unchekedItems(),e(t).toggleClass(s.CHECKED);break;case"range":if(this._unchekedItems(),e(t).toggleClass(s.CHECKED),e(this._list).hasClass(s.MIN)){e(this._list).addClass(s.MAX).removeClass(s.MIN);var n=e(this._parent).find(r.INPUT_MAX);n.length&&n[0].focus(),e(this._parent).find(r.INPUT_MIN).val(Number(t.getAttribute("data-text")).toLocaleString("en")),this._minItem=t}else e(this._list).hasClass(s.MAX)&&(e(this._parent).find(r.INPUT_MAX).val(Number(t.getAttribute("data-text")).toLocaleString("en")),this._maxItem=t,this.toggle())}this._toggleCleanButton(),this._setCaption()},t.prototype.dispose=function(){},t.prototype.reset=function(){if(void 0!==this._config.type){switch(this._config.type){case"range":var t=e(this._parent).find(r.INPUT_MIN),n=e(this._parent).find(r.INPUT_MAX);t.val(this._memory.min),n.val(this._memory.max),this._minItem=null,this._maxItem=null;var a=e.makeArray(e(this._list).find(r.ITEM));for(var i in a)a[i].getAttribute("data-text")===t.val()&&(this._minItem=a[i]),a[i].getAttribute("data-text")===n.val()&&(this._maxItem=a[i]);break;case"multiple":case"single":this._unchekedItems(),e(this._memory.selectedItems).addClass(s.CHECKED)}this._clearSearch(),this.toggle()}},t.prototype.clean=function(){this._unchekedItems();for(var t=e(this._parent).find(r.INPUT),n=0;n<t.length;n++)t[n].value="";this._refreshValueInputs(),this._setLabel(),this._toggleCleanButton()},t.prototype.refresh=function(){this._setCaption(),this._refreshValueInputs(!0),this._toggleCleanButton()},t.prototype._addEventListeners=function(){var n=this;e(this._element).on(i.CLICK,function(e){e.stopPropagation(),e.preventDefault(),n.toggle()}),e(this._element).on(i.CLICK_BTN_CLEAN,r.CLEAN_BUTTON,function(e){e.preventDefault(),e.stopPropagation(),n.clean(),t._clearLists()}),e(this._parent).on("keyup",r.INPUT,function(e){e.preventDefault(),e.stopPropagation(),n._search(this,e)}),e(this._parent).on("keydown",r.INPUT_MIN,r.INPUT_MAX,function(t){if(!(-1!==e.inArray(t.keyCode,[46,8,9,27,13,110,190])||65==t.keyCode&&(!0===t.ctrlKey||!0===t.metaKey)||67==t.keyCode&&(!0===t.ctrlKey||!0===t.metaKey)||88==t.keyCode&&(!0===t.ctrlKey||!0===t.metaKey)||t.keyCode>=35&&t.keyCode<=39))return-1!==e.inArray(t.key,["۰","۱","۲","۳","۴","۵","۶","۷","۸","۹"])?(t.preventDefault(),void(this.value=this.value.concat(String(t.keyCode-48)))):void((t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&t.preventDefault())}),e(this._parent).on(i.CLICK_ITEM,r.ITEM,function(e){e.preventDefault(),e.stopPropagation(),n.toggleItem(e.target)}),e(this._parent).on("focus",r.INPUT,function(t){if(t.preventDefault(),t.stopPropagation(),void 0!==n._config.type)switch(n._config.type){case"range":e(t.target).hasClass(s.MIN)&&(e(n._parent).find(r.LIST).addClass(s.MIN).removeClass(s.MAX),n._unchekedItems(),n._minItem&&n._minItem.getAttribute("data-text")==t.target.value&&e(n._minItem).toggleClass(s.CHECKED)),e(t.target).hasClass(s.MAX)&&(e(n._parent).find(r.LIST).addClass(s.MAX).removeClass(s.MIN),n._unchekedItems(),n._maxItem&&n._maxItem.getAttribute("data-text")==t.target.value&&e(n._maxItem).toggleClass(s.CHECKED))}}),e(this._parent).on(i.CLICK_RESET,r.RESET_BUTTON,function(e){e.preventDefault(),e.stopPropagation(),n.reset()})},t.prototype._getConfig=function(t){var n=e(this._element).data();return void 0!==n.placement&&(n.placement=AttachmentMap[n.placement.toUpperCase()]),t=e.extend({},this.constructor.Default,e(this._element).data(),t)},t.prototype._getDropdownElement=function(){if(!this._dropdown){var n=t._getParentFromElement(this._element);this._dropdown=e(n).children(r.DROPDOWN)}return this._dropdown},t.prototype._getListElement=function(){if(!this._list){var n=t._getParentFromElement(this._element);this._list=e(n).find(r.LIST)}return this._list},t.prototype._getCleanButtonElement=function(){var t=this._parent,n=e(t).find(r.CLEAN_BUTTON);if(n.length>0)return n[0]},t.prototype._unchekedItems=function(){for(var t=e(this._list).children(r.CHECKED_ITEMS),n=0;n<t.length;n++)e(t[n]).removeClass(s.CHECKED)},t.prototype._setCaption=function(){var t=e(this._list).find(r.CHECKED_ITEMS),n=e(this._parent).find(r.CAPTION).html("");switch(this._element.getAttribute("data-type")){case"single":t.length?(n.html(""),void 0!==this._config.showlabel&&"true"===this._config.showlabel&&n.append('<span class="selection-label">'+this._config.label+"</span>"),n.append('<span class="selection-tag">'+t[0].getAttribute("data-text")+"</span>")):this._setLabel();break;case"multiple":if(t.length){n.html("");for(var a=0;a<t.length&&a<3;a++)n.append('<span class="selection-tag">'+t[a].getAttribute("data-text")+"</span>");t.length>3&&(n.html(""),n.append('<span class="selection-label">'+this._config.label+"</span>"),n.append('<span class="selection-tag number">'+t.length+"</span>"))}else this._setLabel();break;case"range":var i=e(this._parent).find(r.INPUT_MIN),s=e(this._parent).find(r.INPUT_MAX);i=i.length?i.val().replace(/[,]*/g,""):void 0,s=s.length?s.val().replace(/[,]*/g,""):void 0,this._toggleCleanButton();var l=0,o=0,h="";if(void 0!==this._config.unit)switch(this._config.unit){case"money":l=this._shortMoneyNumber(i),o=this._shortMoneyNumber(s),h="تومان";break;case"area":l=this._shortAreaNumber(i),o=this._shortAreaNumber(s),h="";break;case"age":l=this._shortAgeNumber(i),o=this._shortAgeNumber(s),h=""}var _=l.unit,c=o.unit;if(_===c&&(_=""),n.html(""),n.append('<span class="selection-label">'+this._config.label+"</span>"),i){s||n.append('<span class="selection-tag">از</span>');var p=Number(l.num);n.append(e('<span class="selection-tag">').html(isNaN(p)?l.num:p.toLocaleString("en"))),""!==_&&n.append(e('<span class="selection-tag">').html(_))}if(s){var u=Number(o.num);n.append('<span class="selection-tag">تا</span>'),n.append(e('<span class="selection-tag">').html(isNaN(u)?o.num:u.toLocaleString("en"))),n.append(e('<span class="selection-tag">').html(c))}""!==h&&n.append('<span class="selection-tag">'+h+"</span>"),i||s||(this._setLabel(),this._unchekedItems())}},t.prototype._setLabel=function(){this._config.label&&e(this._parent).find(r.CAPTION).html(this._config.label)},t.prototype._refreshValueInputs=function(t){var n,a,s,l,o=0,h=!1,_={relatedTarget:this._element},c=e.Event(i.CHANGE,_),p=e.makeArray(e(this._parent).find(r.HIDDEN_VALUES).remove());if(p.length)for(l={},a=0;a<p.length;a++)l[p[a].name]=p[a].value;if(void 0!==this._config.type){switch(this._config.type){case"range":var u=e(this._parent).find(r.INPUT_MIN),d=e(this._parent).find(r.INPUT_MAX);u.val()&&e(this._parent).append(e('<input type="hidden" class="value">').attr("name","min_"+this._element.getAttribute("data-name")).val(e(this._parent).find(r.INPUT_MIN).val().replace(/[,]*/g,""))),d.val()&&e(this._parent).append(e('<input type="hidden" class="value">').attr("name","max_"+this._element.getAttribute("data-name")).val(e(this._parent).find(r.INPUT_MAX).val().replace(/[,]*/g,"")));var m=l?l["min_"+this._element.getAttribute("data-name")]:void 0;void 0!==m&&u.val().replace(/[,]*/g,"")===m||(h=h||!0);var g=l?l["max_"+this._element.getAttribute("data-name")]:void 0;void 0!==g&&d.val().replace(/[,]*/g,"")===g||(h=h||!0);break;case"multiple":if(o=0,n=e.makeArray(e(this._list).find(r.CHECKED_ITEMS)),n.length){for(a in n){e(this._parent).append(e('<input type="hidden" class="value">').attr("name",this._element.getAttribute("data-name")+"[]").val(n[a].getAttribute("data-value")));for(s in p)p[s].value===n[a].getAttribute("data-value")&&(p.splice(s,1),o++)}(p.length>=o||n.length>o)&&(h=!0)}else p.length&&(h=!0);break;case"single":if(o=0,n=e.makeArray(e(this._list).find(r.CHECKED_ITEMS)),n.length){for(a in n){e(this._parent).append(e('<input type="hidden" class="value">').attr("name",this._element.getAttribute("data-name")).val(n[a].getAttribute("data-value")));for(s in p)p[s].value===n[a].getAttribute("data-value")&&(p.splice(s,1),o++)}(p.length>=o||n.length>o)&&(h=!0)}else p.length&&(h=!0)}h&&void 0===t&&e(this._parent).trigger(c)}},t.prototype._toggleCleanButton=function(){if(void 0!==this._config.cleanable&&!1!==this._config.cleanable&&void 0!==this._config.type){var t=this._getCleanButtonElement();switch(e(t).removeClass(s.SHOW),this._config.type){case"range":var n=e(this._parent).find(r.INPUT_MIN),a=e(this._parent).find(r.INPUT_MAX);if(n.val()||a.val())return void e(t).addClass(s.SHOW);break;case"multiple":case"single":e(this._list).find(r.CHECKED_ITEMS).length>0&&e(t).addClass(s.SHOW)}}},t.prototype._saveMemory=function(){if(void 0!==this._config.type)switch(this._config.type){case"range":var t=e(this._parent).find(r.INPUT_MIN),n=e(this._parent).find(r.INPUT_MAX);this._memory.min=t?t.val():null,this._memory.max=n?n.val():null;break;case"multiple":case"single":this._memory.selectedItems=e.makeArray(e(this._list).find(r.CHECKED_ITEMS))}},t.prototype._search=function(n,a){if(void 0!==this._config.type){var i=[],l=[],o=0,h="",_=String(n.value);switch(this._config.type){case"range":if(_=_.replace(/[,]*/g,""),isNaN(Number(_))||""===_)return;h=Number(_).toLocaleString("en"),n.value=h;break;case"multiple":case"single":i=e.makeArray(this._list.find(r.ITEM)),_=_.replace(/[ ]*/g,"").toLowerCase();for(o in i)h=i[o].getAttribute("data-text").replace(/[ ]*/g,"").toLowerCase(),h+=t._convertToLatinChar(h),h.indexOf(_)>-1?e(i[o]).removeClass(s.HIDE):e(i[o]).addClass(s.HIDE);l=e(this._parent).find(r.VISIBLE_ITEMS),0===l.length?e(this._parent).find(r.NEW_BUTTON).addClass(s.SHOW):e(this._parent).find(r.NEW_BUTTON).removeClass(s.SHOW)}}},t.prototype._shortMoneyNumber=function(e){if(isNaN(Number(e)))return{num:0,unit:"",real:0};var t=0,n=0;return e>=1e9?(t=e/1e9,n=t==parseInt(t)?String(t):parseFloat(t),{num:n,unit:"میلیارد",real:e}):e>=1e6?(t=e/1e6,n=t==parseInt(t)?String(t):parseFloat(t),{num:n,unit:"میلیون",real:e}):e>=1e3?(t=e/1e3,n=t==parseInt(t)?String(t):parseFloat(t),{num:n,unit:"هزار",real:e}):{num:e,unit:"",real:e}},t.prototype._shortAreaNumber=function(e){if(isNaN(Number(e)))return{num:0,unit:"",real:0};var t=0,n=0;return e>=1e4?(t=e/1e4,n=t,{num:n,unit:"هکتار",real:e}):e>=1e3?(t=e/1e3,n=t,{num:n,unit:"هزار متر",real:e}):{num:e,unit:"متر",real:e}},t.prototype._shortAgeNumber=function(e){if(isNaN(Number(e)))return{num:0,unit:"",real:0};return 0===Number(e)?{num:"نوساز",unit:"",real:e}:{num:e,unit:"سال",real:e}},t.prototype._clearSearch=function(){if(void 0!==this._config.type)switch(this._config.type){case"multiple":case"single":e(this._parent).find(r.INPUT).val(""),e(this._list).find(r.HIDDEN_ITEMS).removeClass(s.HIDE)}},t._jQueryInterface=function(n){return this.each(function(){var a=e(this).data("ma.selection"),i="object"==(void 0===n?"undefined":typeof n)?n:null;if(a||(a=new t(this,i),e(this).data("ma.selection",a)),"string"==typeof n){if(void 0===a[n])throw new Error('No method named "'+n+'"');a[n]()}})},t._clearLists=function(n){if(!n||3!==n.which&&("keyup"!==n.type||9===n.which))for(var a=e.makeArray(e(r.DATA_TOGGLE)),l=0;l<a.length;l++){var o=t._getParentFromElement(a[l]),h=e(a[l]).data("ma.selection"),_={relatedTarget:a[l]};if(h){var c=h._dropdown;if(e(o).hasClass(s.SHOW)&&!(n&&("click"===n.type&&/input|textarea/i.test(n.target.tagName)||"keyup"===n.type&&9===n.which)&&e.contains(o,n.target))){var p=e.Event(i.HIDE,_);e(o).trigger(p),p.isDefaultPrevented()||("ontouchstart"in document.documentElement&&e("body").children().off("mouseover",null,e.noop),a[l].setAttribute("aria-expanded","false"),e(c).removeClass(s.SHOW),e(o).removeClass(s.SHOW).trigger(e.Event(i.HIDDEN,_)),t._jQueryInterface.call(e(a[l]),"_refreshValueInputs"),t._jQueryInterface.call(e(a[l]),"_setCaption"),t._jQueryInterface.call(e(a[l]),"_clearSearch"))}}}},t._getParentFromElement=function(e){return e.parentNode},t._dataApiKeydownHandler=function(n){if(!this.disabled&&!e(this).hasClass(s.DISABLED)){var a=t._getParentFromElement(this),i=e(a).hasClass(s.SHOW),l=e(a).find(r.DATA_TOGGLE)[0];return i||32!==n.which&&40!==n.which||!n.target.hasAttribute("data-toggle")?i&&27===n.which?(e(l).trigger("focus"),void e(l).trigger("click")):void 0:void e(l).trigger("click")}},t._convertToLatinChar=function(t){for(var n=["ا","ب","پ","ت","ث","ج","چ","ح","خ","د","ذ","ر","ز","ژ","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ک","گ","ل","م","ن","و","ه","ی","آ","ء","إ","أ","ي","ة","-‌","۱","۲","۳","۴","۵","۶","۷","۸","۹","۰"],a=["h","f","m","j","e","[","]","p","o","n","b","v","c","c","s","a","w","q","x","z","u","y","t","r",";","'","g","l","k",",","i","d","h","m","f","g","d","j","-‌","1","2","3","4","5","6","7","8","9","0"],i=0,s="",r=0;r<t.length;r++)(i=e.inArray(t[r],n))>=0&&(s+=a[i]);return s},t}();return e(document).on(i.KEYDOWN_DATA_API,r.DATA_TOGGLE,l._dataApiKeydownHandler).on(i.KEYDOWN_DATA_API,r.DROPDOWN,l._dataApiKeydownHandler).on(i.CLICK_DATA_API+" "+i.KEYUP_DATA_API,l._clearLists).on(i.CLICK_DATA_API,r.DATA_TOGGLE,function(t){t.preventDefault(),t.stopPropagation(),l._jQueryInterface.call(e(this),"toggle")}),e.fn[t]=l._jQueryInterface,e.fn[t].Constructor=l,e.fn[t].noConflict=function(){return e.fn[t]=a,l._jQueryInterface},l}(jQuery);